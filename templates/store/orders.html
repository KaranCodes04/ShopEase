{% extends "base.html" %}
{% load humanize %}

{% block title %}My Orders{% endblock %}

{% block content %}
<style>
  /* small page-specific tweaks to match your theme */
  .orders-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
    gap: 20px;
    align-items: start;
  }

  .order-card {
    border-radius: 12px;
    padding: 20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.96));
    box-shadow: 0 8px 28px rgba(0,0,0,0.08);
    border: 1px solid rgba(90,24,154,0.06);
  }

  .order-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    margin-bottom:12px;
  }

  .order-id {
    font-weight:700;
    color:var(--purple-3);
    font-size:1.05rem;
  }

  .order-meta { color:#666; font-size:.95rem; }

  .order-row { display:flex; justify-content:space-between; align-items:center; margin-top:10px; }

  .btn-outline-purple {
    background: transparent;
    color: var(--purple-3);
    border: 1px solid var(--purple-3);
    padding:.45rem .9rem;
    border-radius: 8px;
  }
  .btn-outline-purple:hover {
    background: var(--purple-3);
    color: #fff;
  }

  .order-footer {
    margin-top:14px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }

  .empty-state {
    text-align:center;
    padding:50px 20px;
    border-radius:12px;
    background: rgba(255,255,255,0.95);
    box-shadow: 0 8px 28px rgba(0,0,0,0.06);
  }
</style>

<div class="text-center mb-4">
  <h1 class="fw-bold" style="color:var(--purple-3);">My Orders</h1>
  <p class="text-muted">All purchases you placed on ShopEase. Click View to see order items.</p>
</div>

<div class="orders-grid">
  {% if orders %}
    {% for order in orders %}
      <div class="order-card">
        <div class="order-header">
          <div>
            <div class="order-id">Order #{{ order.id }}</div>
            <div class="order-meta">Items: <strong>{{ order.items.count }}</strong></div>
          </div>
          <div class="text-end">
            <div style="font-weight:700; font-size:1.05rem;">₹{{ order.total }}</div>
            <div class="order-meta">{{ order.created_at|date:"M j, Y, g:i a" }}</div>
          </div>
        </div>

        <hr>

        <div>
          {% if order.items.all %}
            <ul class="list-unstyled mb-0">
              {% for item in order.items.all|slice:":3" %}
                <li class="d-flex justify-content-between align-items-center py-2">
                  <div>
                    <div style="font-weight:600;">{{ item.product.name }}</div>
                    <small class="text-muted">Qty: {{ item.quantity }} • ₹{{ item.price }}</small>
                  </div>
                  <div class="text-end text-muted">₹{{ item.subtotal }}</div>
                </li>
              {% endfor %}
            </ul>

            {% if order.items.count > 3 %}
              <div class="mt-2 small text-muted">+ {{ order.items.count|add:"-3" }} more items</div>
            {% endif %}
          {% else %}
            <div class="text-muted">No items recorded for this order.</div>
          {% endif %}
        </div>

        <div class="order-footer">
          <a href="{% url 'store:order_detail' order.id %}" class="btn-outline-purple">View</a>
          <div class="text-muted small">Order total <strong>₹{{ order.total }}</strong></div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state col-12">
      <h3 style="color:var(--purple-3);">You have no orders yet</h3>
      <p class="text-muted">When you place an order, it will appear here. Start shopping now!</p>
      <a class="btn btn-purple" href="{% url 'store:product_list' %}">Start Shopping</a>
    </div>
  {% endif %}
</div>
{% endblock %}

